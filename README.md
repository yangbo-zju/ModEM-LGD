# ModEM-LGD

Repository for the manuscript **"Towards Practical and Reliable Electromagnetic Inversion: A Semi-Stochastic Lévy Gradient Descent Approach with Built-in Uncertainty Estimation"** by **Ziyu Tang**, **Bo Yang**, and **Yi Zhang** with Zhejiang University, Hangzhou, China.

This repository contains a new branch of **ModEM** that implements the **Lévy Gradient Descent (LGD)** algorithm for 3D magnetotelluric (MT) inversion.

## What’s New with LGD?

Traditional gradient-based inversion methods are computationally efficient but cannot provide model uncertainty estimates. In contrast, stochastic inversion methods offer uncertainty quantification but become prohibitively expensive for 3D problems.

The LGD method bridges this gap by combining the efficiency of gradient-based search with the global exploration capabilities of stochastic processes. It enables escape from local minima, supports global search, and—critically—delivers built-in model uncertainty estimates at a manageable computational cost.

Tests on synthetic and field data demonstrate that LGD achieves good convergence and produces high-resolution inversion results. Beyond data misfit, the uncertainty information provided by LGD allows for **quantitative estimation of uncertainty for each model parameter**, which is essential for robust geophysical interpretation.

## What Has Been Changed?

We include all files required to compile the executables. This code is a fork and extension of Dr. Hao Dong’s **ModEM-GPU** version (URL: https://github.com/dong-hao/ModEM-GPU). Below is a list of files that have been **modified or newly added** relative to Hao’s version, to help users track changes:

1. `3D_MT/SP2/EMsolve3D.f90`
2. `3D_MT/modelParam/ModelSpace.f90`
3. `3D_MT/main.f90`
4. `INV/INVcore.f90`
5. `INV/LGD.f90`
6. `UTILS/math_constants.f90`
7. `UserCtrl.f90`
8. `Mod3DMT.f90`
9. `Makefile.gpu`

## Test Cases

We provide **all test cases** presented in the manuscript. For each inversion run, the following files are included:

- Input data file
- Initial model file
- Final inverted model file
- Corresponding predicted data file

> **Note**: Due to the semi-stochastic nature of LGD, results may vary slightly across runs. We are currently developing a version that records every step length generated by the Lévy flight process, enabling exact replay of the search trajectory.

## Compilation and Runtime Environment

The code has been compiled and tested under the following hardware and software environment:

- **Server**: Dell PowerEdge T640 and R750
- **CPU**: Intel Xeon Gold 6248R
- **GPU**: NVIDIA GeForce RTX 3090 and 4090
- **Fortran compiler**: Intel oneAPI `ifort` (IFORT) 2021.6.0 (Build 20220226)
- **NVIDIA driver**: 550.144.03
- **CUDA**: 12.4

## License

This version is subject to the original **non-commercial use license**. Please refer to the COPYRIGHT file and License page for full details.

## Contact

For questions, comments, or suggestions about the **LGD algorithm or scientific aspects**, please contact:
 **bo.yang@zju.edu.cn**

For **compilation or technical issues related to the ModEM-GPU base code**, Dr. Hao Dong is the expert best suited to contact—you may reach out to him directly (**donghao@cugb.edu.cn**).